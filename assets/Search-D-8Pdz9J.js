import{c as G,u as U,r as s,N as O,f as X,D as Y,E as k,j as e,F as R,X as Z,t as i,B as z,C as J,z as A,H as K,R as V}from"./index-BnXzYopL.js";import{T as W}from"./TopBar-CxYairEo.js";import{F as ee,A as te}from"./file-text-B2R12muY.js";import{A as ae}from"./alert-circle-BkFTs681.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=G("ArrowDownCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),de=()=>{const[E,g]=U(),x=E.get("q")||"",[r,w]=s.useState(x),[h,u]=s.useState([]),[o,m]=s.useState([]),[N,y]=s.useState(!1),[S,p]=s.useState(!1),[C,I]=s.useState([]),{navigateToAyah:F}=s.useContext(O),f=s.useRef(null),b=s.useRef(null);s.useRef(0);const P=20;s.useEffect(()=>{X().then(I)},[]),s.useEffect(()=>{const t=sessionStorage.getItem("search_scroll_pos");t&&o.length>0&&window.scrollTo(0,parseInt(t))},[o]);const T=s.useCallback(async t=>{if(!t.trim()){u([]),m([]),y(!1);return}y(!0),p(!0);try{const d=(await Y(t)).sort((n,l)=>n.matchType==="exact"&&l.matchType!=="exact"?-1:l.matchType==="exact"&&n.matchType!=="exact"?1:n.surah.number!==l.surah.number?n.surah.number-l.surah.number:n.ayah.numberInSurah-l.ayah.numberInSurah);u(d),m(d.slice(0,P))}catch(a){console.error(a)}finally{y(!1)}},[]);s.useEffect(()=>{x&&T(x)},[]);const _=t=>{const a=t.target.value;if(w(a),a===""){p(!1),u([]),g({},{replace:!0});return}f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{g({q:a},{replace:!0}),T(a)},500)},j=(t,a,d)=>{sessionStorage.setItem("search_scroll_pos",window.scrollY.toString()),F(t,a,d>0?d:void 0)},D=()=>{m(h)};s.useEffect(()=>{const t=()=>{var a;document.activeElement===b.current&&((a=b.current)==null||a.blur())};return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)},[]);const L=()=>{window.history.pushState({isSearchFocused:!0},"")},B=()=>{var t;(t=window.history.state)!=null&&t.isSearchFocused&&window.history.back()},q=()=>{var t;w(""),u([]),m([]),p(!1),g({},{replace:!0}),(t=b.current)==null||t.focus()},v=r?C.filter(t=>t.name.includes(r)||t.number.toString()===r||k(t.name).includes(k(r))):[],H=({text:t,term:a})=>{if(!a.trim())return e.jsx(e.Fragment,{children:t});const n=k(a).split(/\s+/).filter(c=>c.length>0),l=t.split(" ");return e.jsx("span",{className:"text-navy-900 dark:text-white",children:l.map((c,M)=>{const $=n.some(Q=>K(c,Q));return e.jsxs(V.Fragment,{children:[$?e.jsx("span",{className:"bg-gold-200 dark:bg-gold-600/60 text-navy-900 dark:text-white rounded px-0.5 shadow-sm font-bold",children:c}):c," "]},M)})})};return e.jsxs("div",{className:"flex flex-col h-full bg-gold-50 dark:bg-navy-950 font-sans",children:[e.jsx(W,{title:"البحث في المصحف"}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-24",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-gold-50/95 dark:bg-navy-950/95 backdrop-blur-md px-4 py-4 border-b border-navy-100 dark:border-navy-800 transition-all duration-300",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:b,type:"text",value:r,onChange:_,onFocus:L,onBlur:B,placeholder:"ابحث عن آية (مثال: أمن، جنات عدن)...",className:"w-full h-14 pl-14 pr-12 rounded-2xl border-2 border-transparent bg-white dark:bg-navy-900 text-navy-900 dark:text-white shadow-sm focus:border-gold-500 focus:ring-0 outline-none transition-all text-lg font-bold placeholder:font-normal placeholder:text-navy-300",autoFocus:!x}),e.jsx("div",{className:"absolute right-4 top-4 text-navy-400",children:e.jsx(R,{size:24})}),r&&e.jsx("button",{onClick:q,className:"absolute left-3 top-3 p-2 bg-navy-100 dark:bg-navy-800 text-navy-500 rounded-full hover:bg-red-100 hover:text-red-500 transition-colors",children:e.jsx(Z,{size:16})})]})}),e.jsxs("div",{className:"px-4 py-4 space-y-6",children:[N&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 animate-pulse",children:[e.jsx("div",{className:"w-16 h-16 bg-navy-100 dark:bg-navy-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(R,{size:32,className:"text-navy-300"})}),e.jsx("p",{className:"text-navy-500 dark:text-navy-400 font-bold",children:"جاري البحث..."})]}),!N&&r.trim()!==""&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[v.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-navy-800 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(z,{size:18,className:"text-gold-500"}),"السور المطابقة (",i(v.length),")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:v.map(t=>e.jsxs("button",{onClick:()=>j(t.number,1,A[t.number]||1),className:"flex items-center justify-between p-4 bg-white dark:bg-navy-900 rounded-xl border border-navy-100 dark:border-navy-800 hover:border-gold-500 hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-navy-50 dark:bg-navy-800 rounded-lg flex items-center justify-center text-navy-600 dark:text-navy-300 font-bold group-hover:bg-gold-500 group-hover:text-white transition-colors",children:i(t.number)}),e.jsx("span",{className:"text-lg font-bold text-navy-800 dark:text-white group-hover:text-gold-600 dark:group-hover:text-gold-400",children:t.name})]}),e.jsx(J,{size:20,className:"text-navy-300 group-hover:text-gold-500"})]},t.number))})]}),o.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold text-navy-800 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-gold-500"}),"نتائج الآيات (",i(h.length),")"]}),e.jsx("span",{className:"text-[10px] text-navy-400 bg-navy-50 dark:bg-navy-800 px-2 py-1 rounded-lg",children:"بحث دقيق"})]}),e.jsx("div",{className:"space-y-4",children:o.map((t,a)=>e.jsxs("div",{className:"bg-white dark:bg-navy-900 p-5 rounded-2xl shadow-sm border border-navy-100 dark:border-navy-800 hover:border-gold-300 dark:hover:border-navy-600 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 border-b border-navy-50 dark:border-navy-800 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-navy-600 dark:text-navy-300 bg-navy-50 dark:bg-navy-800 px-3 py-1 rounded-full",children:t.surah.name}),e.jsxs("span",{className:"text-xs text-navy-400",children:["آية ",i(t.ayah.numberInSurah)]})]}),e.jsxs("button",{onClick:()=>j(t.surah.number,t.ayah.numberInSurah,t.ayah.page),className:"flex items-center gap-1 text-[10px] font-bold text-white bg-gold-500 hover:bg-gold-600 px-3 py-1.5 rounded-lg transition-colors shadow-sm",children:[e.jsx("span",{children:"انتقال"}),e.jsx(te,{size:14})]})]}),e.jsx("p",{className:"font-quran text-xl md:text-2xl text-navy-900 dark:text-white leading-[2.6] text-justify",dir:"rtl",children:e.jsx(H,{text:t.ayah.text,term:r})})]},`${t.surah.number}-${t.ayah.number}-${a}`))}),o.length<h.length&&e.jsxs("button",{onClick:D,className:"w-full py-4 mt-6 bg-navy-100 dark:bg-navy-800 text-navy-600 dark:text-navy-300 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-gold-500 hover:text-white transition-all",children:[e.jsx(se,{size:20}),"عرض باقي النتائج (",i(h.length-o.length),")"]})]}):S&&v.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center border-2 border-dashed border-navy-200 dark:border-navy-800 rounded-3xl bg-navy-50/50 dark:bg-navy-900/20",children:[e.jsx("div",{className:"bg-white dark:bg-navy-900 p-4 rounded-full mb-3 shadow-sm",children:e.jsx(ae,{size:32,className:"text-navy-300"})}),e.jsx("h3",{className:"text-base font-bold text-navy-700 dark:text-navy-200",children:"لم يتم العثور على نتائج دقيقة"}),e.jsx("p",{className:"text-xs text-navy-500 mt-1",children:"جرب البحث عن جذر الكلمة أو تأكد من الإملاء الصحيح."})]})]}),!S&&!r&&e.jsxs("div",{className:"animate-in fade-in",children:[e.jsxs("h3",{className:"font-bold text-navy-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(z,{size:18,className:"text-gold-500"}),"فهرس السور (انتقال سريع)"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:C.map(t=>e.jsxs("button",{onClick:()=>j(t.number,1,A[t.number]||1),className:"flex items-center justify-between p-3 bg-white dark:bg-navy-900 rounded-xl border border-navy-100 dark:border-navy-800 hover:border-gold-500 hover:shadow-md transition-all group text-right",children:[e.jsx("span",{className:"text-sm font-bold text-navy-700 dark:text-white group-hover:text-gold-600",children:t.name}),e.jsx("span",{className:"text-xs text-navy-400 bg-navy-50 dark:bg-navy-800 px-1.5 py-0.5 rounded font-sans",children:t.number})]},t.number))})]})]})]})]})};export{de as Search};
