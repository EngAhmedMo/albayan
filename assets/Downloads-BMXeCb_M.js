import{c as E,d as G,r as a,f as J,at as C,j as e,au as K,av as V,t as i,aw as Y,P as Z,ax as _,ay as ee,az as te,aA as se,aB as ae}from"./index-BnXzYopL.js";import{T as ne}from"./TopBar-CxYairEo.js";import{T as $}from"./trash-2-DB6w517q.js";import{X as re,C as le}from"./x-circle-Cbn9dHDp.js";import{A as de}from"./alert-circle-BkFTs681.js";import{D as oe}from"./download-4QIELjBG.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=E("HardDriveDownload",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m16 6-4 4-4-4",key:"6wukr"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 18h.01",key:"h775k"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=E("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ge=()=>{var R,B;const{reciterId:p,setReciterId:I}=G(),[c,T]=a.useState([]),[u,x]=a.useState({}),[M,D]=a.useState({}),[n,Q]=a.useState(p),[o,f]=a.useState(!1),[h,j]=a.useState(!1),[w,S]=a.useState(!1),[d,m]=a.useState(null),[z,g]=a.useState([]),v=a.useRef(null);a.useEffect(()=>{J().then(T)},[]);const k=async()=>{if(c.length===0)return;const t={};await Promise.all(c.map(async s=>{const r=await _(n,s.number);t[s.number]=r?"downloaded":"none"})),x(s=>({...s,...t}))};a.useEffect(()=>{k()},[c,n]);const O=async t=>{x(s=>({...s,[t.number]:"loading"})),D(s=>({...s,[t.number]:0}));try{await se(n,t.number,s=>{D(r=>({...r,[t.number]:s}))}),x(s=>({...s,[t.number]:"downloaded"}))}catch(s){console.error(s),alert("فشل التحميل، يرجى التحقق من الإنترنت"),x(r=>({...r,[t.number]:"none"}))}},F=async t=>{window.confirm(`هل تريد حذف سورة ${t.name} من التخزين؟`)&&(await te(n,t.number),x(s=>({...s,[t.number]:"none"})))},P=async(t,s,r)=>{f(!0),j(!1),v.current=new AbortController;try{await ae(n,t,l=>{x(N=>({...N,[l]:"downloaded"})),g(N=>N.filter(W=>W!==l))},l=>{m({completed:l,total:r})},s,v.current.signal),f(!1),m(null),g([]),await k()}catch(l){l.message==="PAUSED"?j(!0):(console.error(l),alert("حدث خطأ أثناء التحميل. تم الإيقاف."),f(!1),m(null))}},L=()=>{const t=c.filter(s=>u[s.number]!=="downloaded").map(s=>s.number);if(t.length===0){alert("جميع السور محملة بالفعل!");return}g(t),m({completed:0,total:t.length}),P(t,0,t.length)},H=()=>{var t;(t=v.current)==null||t.abort()},X=()=>{d&&P(z,d.completed,d.total)},q=()=>{var t;(t=v.current)==null||t.abort(),f(!1),j(!1),m(null),g([])},U=async()=>{const t=Object.values(u).filter(s=>s==="downloaded").length;if(t!==0&&window.confirm(`هل أنت متأكد من حذف ${i(t)} سورة للقارئ الحالي؟`)){S(!0);try{await ee(n),await k()}finally{S(!1)}}},A=(R=C.find(t=>t.id===n))==null?void 0:R.name,b=Object.values(u).filter(t=>t==="downloaded").length,y=c.length;return e.jsxs("div",{className:"flex flex-col h-full bg-gold-50 dark:bg-navy-950 font-sans",children:[e.jsx(ne,{title:"إدارة التحميلات"}),e.jsxs("div",{className:"flex-1 overflow-y-auto pb-24",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-navy-900 border-b border-navy-100 dark:border-navy-800 shadow-sm sticky top-0 z-20",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-navy-900 dark:text-white flex items-center gap-2",children:[e.jsx(K,{className:"text-gold-500"})," الاستماع دون إنترنت"]}),e.jsx("p",{className:"text-xs text-navy-500 dark:text-navy-400 mt-1",children:"قم بتحميل السور للاستماع إليها لاحقاً لتوفير البيانات."})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar mb-2",children:C.map(t=>e.jsxs("button",{onClick:()=>!o&&Q(t.id),disabled:o,className:`flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all border ${n===t.id?"bg-navy-800 text-white border-navy-800 shadow-md":"bg-navy-50 dark:bg-navy-800 text-navy-600 dark:text-navy-300 border-navy-100 dark:border-navy-700 hover:bg-navy-100"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[n===t.id&&e.jsx(V,{size:12}),t.name]},t.id))}),e.jsxs("div",{className:"bg-navy-50 dark:bg-navy-950 rounded-xl p-4 border border-navy-100 dark:border-navy-800 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-navy-600 dark:text-navy-300",children:"حالة التخزين:"}),e.jsxs("span",{className:"bg-white dark:bg-navy-800 px-2 py-0.5 rounded-lg text-xs font-bold text-gold-600 dark:text-gold-500 border border-navy-100 dark:border-navy-700 shadow-sm",children:[i(b)," / ",i(y)," سورة"]})]}),b>0&&!o&&e.jsxs("button",{onClick:U,disabled:w,className:"text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 px-2 py-1 rounded-lg text-xs font-bold flex items-center gap-1 transition-colors",children:[w?e.jsx(ce,{size:12,className:"animate-spin"}):e.jsx($,{size:12}),"حذف الكل"]})]}),d&&(o||h)?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-navy-600 dark:text-navy-300",children:[e.jsx("span",{children:h?"التحميل متوقف مؤقتاً":"جاري تحميل الباقة..."}),e.jsxs("span",{children:[i(d.completed)," من ",i(d.total)]})]}),e.jsx("div",{className:"w-full h-3 bg-navy-200 dark:bg-navy-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${h?"bg-amber-500":"bg-gold-500 striped-bar"}`,style:{width:`${d.completed/d.total*100}%`}})}),e.jsxs("div",{className:"flex gap-2",children:[h?e.jsxs("button",{onClick:X,className:"flex-1 py-2 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 rounded-lg text-xs font-bold flex items-center justify-center gap-2 hover:bg-emerald-100 transition-colors",children:[e.jsx(Z,{size:14})," استكمال"]}):e.jsxs("button",{onClick:H,className:"flex-1 py-2 bg-amber-50 dark:bg-amber-900/20 text-amber-600 rounded-lg text-xs font-bold flex items-center justify-center gap-2 hover:bg-amber-100 transition-colors",children:[e.jsx(Y,{size:14})," إيقاف مؤقت"]}),e.jsxs("button",{onClick:q,className:"flex-1 py-2 bg-red-50 dark:bg-red-900/20 text-red-500 rounded-lg text-xs font-bold flex items-center justify-center gap-2 hover:bg-red-100 transition-colors",children:[e.jsx(re,{size:14})," إلغاء"]})]})]}):e.jsx("button",{onClick:L,disabled:b===y||w,className:`w-full py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm shadow-sm transition-all ${b===y?"bg-emerald-100 text-emerald-700 cursor-default":"bg-gold-500 hover:bg-gold-600 text-navy-900"}`,children:b===y?e.jsxs(e.Fragment,{children:[e.jsx(le,{size:18})," المصحف محمل بالكامل"]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:18})," تحميل المصحف كاملاً (",A,")"]})})]})]}),n!==p&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-200 dark:border-amber-800 flex items-start gap-3",children:[e.jsx(de,{size:18,className:"text-amber-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-amber-800 dark:text-amber-200",children:[e.jsx("span",{className:"font-bold",children:"تنبيه:"})," القارئ المختار حالياً للاستماع هو (",(B=C.find(t=>t.id===p))==null?void 0:B.name,").",e.jsxs("button",{onClick:()=>I(n),className:"block mt-1 underline font-bold",children:["تعيين ",A," كقارئ افتراضي"]})]})]}),e.jsx("div",{className:"p-4 space-y-3",children:c.map(t=>{const s=u[t.number]||"none",r=M[t.number]||0,l=o&&z.includes(t.number)&&s!=="loading";return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-navy-900 rounded-xl border border-navy-100 dark:border-navy-800 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-navy-50 dark:bg-navy-800 flex items-center justify-center text-sm font-bold text-navy-600 dark:text-navy-300 font-sans",children:i(t.number)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-navy-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-[10px] text-navy-400",children:[i(t.numberOfAyahs)," آية"]})]})]}),e.jsx("div",{children:s==="downloaded"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-400",children:"تم التحميل"}),e.jsx("button",{onClick:()=>F(t),className:"p-2 text-red-400 bg-red-50 dark:bg-red-900/10 rounded-full hover:bg-red-100 transition-colors",children:e.jsx($,{size:18})})]}):s==="loading"?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-24 h-2 bg-navy-100 dark:bg-navy-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gold-500 transition-all duration-300",style:{width:`${r}%`}})}),e.jsxs("span",{className:"text-[10px] font-bold text-gold-600 w-8 text-left",children:[r,"%"]})]}):l?e.jsx("span",{className:"text-[10px] font-bold text-navy-400",children:"في الانتظار..."}):e.jsxs("button",{onClick:()=>O(t),disabled:o,className:"flex items-center gap-2 px-3 py-2 bg-navy-50 dark:bg-navy-800 hover:bg-gold-500 hover:text-white dark:hover:bg-gold-500 text-navy-600 dark:text-navy-300 rounded-lg text-xs font-bold transition-all disabled:opacity-50",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"تحميل"})]})})]},t.number)})})]})]})};export{ge as Downloads};
